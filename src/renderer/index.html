<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            http-equiv="Content-Security-Policy"
            content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; connect-src 'self' https://raw.githubusercontent.com https://*.crm.dynamics.com; frame-src 'self' pptb-webview:"
        />
        <title>Power Platform Tool Box</title>
        <link rel="stylesheet" href="styles.scss" />
    </head>
    <body>
        <div class="app-container">
            <!-- Activity Bar (VSCode-like narrow sidebar) -->
            <aside class="activity-bar" id="activity-bar">
                <div class="activity-bar-header">
                    <div class="app-icon" title="Power Platform Tool Box">
                        <img id="app-icon-img" src="icons/dark/app-icon.svg" alt="App Icon" />
                    </div>
                </div>
                <nav class="activity-bar-nav">
                    <button class="activity-item active" data-sidebar="tools" title="Installed Tools">
                        <img id="tools-icon" src="icons/dark/tools.svg" alt="Tools Icon" class="activity-icon" />
                    </button>
                    <button class="activity-item" data-sidebar="connections" title="Connection Manager">
                        <img id="connections-icon" src="icons/dark/connections.svg" alt="Connections Icon" class="activity-icon" />
                    </button>
                    <button class="activity-item" data-sidebar="marketplace" title="Tools Marketplace">
                        <img id="marketplace-icon" src="icons/dark/marketplace.svg" alt="Marketplace Icon" class="activity-icon" />
                    </button>
                    <button class="activity-item" data-sidebar="debug" title="Debug / Install by Package">
                        <img id="debug-icon" src="icons/dark/debug.svg" alt="Debug Icon" class="activity-icon" />
                    </button>
                </nav>
                <nav class="activity-bar-footer">
                    <button class="activity-item" data-sidebar="settings" title="Settings">
                        <img id="settings-icon" src="icons/dark/settings.svg" alt="Settings Icon" class="activity-icon" />
                    </button>
                </nav>
            </aside>

            <!-- Sidebar (context-sensitive based on Activity Bar selection) -->
            <aside class="sidebar" id="sidebar">
                <!-- Tools Sidebar -->
                <div class="sidebar-content active" id="sidebar-tools">
                    <div class="sidebar-header">
                        <h2 class="sidebar-title">INSTALLED</h2>
                    </div>
                    <div class="sidebar-search">
                        <input type="text" id="tools-search-input" class="fluent-input" placeholder="Search installed tools..." />
                    </div>
                    <div class="sidebar-body">
                        <div class="tools-list-vscode" id="sidebar-tools-list">
                            <!-- Tools will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Connections Sidebar -->
                <div class="sidebar-content" id="sidebar-connections">
                    <div class="sidebar-header">
                        <h2 class="sidebar-title">CONNECTIONS</h2>
                        <button id="sidebar-add-connection-btn" class="fluent-button fluent-button-primary">+ Add</button>
                    </div>
                    <div class="sidebar-body">
                        <div class="connections-list-sidebar" id="sidebar-connections-list">
                            <!-- Connections will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Marketplace Sidebar -->
                <div class="sidebar-content" id="sidebar-marketplace">
                    <div class="sidebar-header">
                        <h2 class="sidebar-title">MARKETPLACE</h2>
                    </div>
                    <div class="sidebar-search">
                        <input type="text" id="marketplace-search-input" class="fluent-input" placeholder="Search tools..." />
                    </div>
                    <div class="sidebar-body">
                        <div class="marketplace-tools-list-vscode" id="marketplace-tools-list">
                            <!-- Marketplace tools will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Debug Sidebar -->
                <div class="sidebar-content" id="sidebar-debug">
                    <div class="sidebar-header">
                        <h2 class="sidebar-title">DEBUG</h2>
                    </div>
                    <div class="sidebar-body">
                        <div class="debug-container-sidebar">
                            <div class="debug-section">
                                <h3 class="debug-section-title">Load Local Tool</h3>
                                <p class="debug-section-description">Load a tool directly from your local file system for development and testing.</p>
                                <div class="debug-input-group">
                                    <label class="debug-label" for="sidebar-local-tool-path">Tool Directory Path</label>
                                    <div class="debug-path-input-group">
                                        <input type="text" id="sidebar-local-tool-path" class="fluent-input" placeholder="Select tool directory..." readonly />
                                        <button id="sidebar-browse-local-tool-btn" class="fluent-button fluent-button-secondary">Browse</button>
                                    </div>
                                    <span class="debug-hint">Select the root directory containing your tool's package.json</span>
                                </div>
                                <div class="debug-actions">
                                    <button id="sidebar-load-local-tool-btn" class="fluent-button fluent-button-primary">Load Tool</button>
                                </div>
                            </div>
                            <div class="debug-section">
                                <h3 class="debug-section-title">Install Tool by Package Name</h3>
                                <p class="debug-section-description">Enter an npm package name to install a custom tool directly from the npm registry.</p>
                                <div class="debug-input-group">
                                    <label class="debug-label" for="sidebar-package-name-input">Package Name</label>
                                    <input type="text" id="sidebar-package-name-input" class="fluent-input" placeholder="e.g., @powerplatform/tool-example" />
                                    <span class="debug-hint">Enter the full npm package name including scope (if applicable)</span>
                                </div>
                                <div class="debug-actions">
                                    <button id="sidebar-install-package-btn" class="fluent-button fluent-button-primary">Install Package</button>
                                </div>
                            </div>
                            <div class="debug-section">
                                <h3 class="debug-section-title">About These Features</h3>
                                <p class="debug-section-description">These features are designed for tool developers to quickly test and install their tools without publishing to the marketplace.</p>
                                <ul class="debug-info-list">
                                    <li>üìÇ <strong>Local Tool:</strong> Load tools from your filesystem - no publishing needed</li>
                                    <li>üîÑ <strong>Watch Mode:</strong> Build your tool with watch mode, then reload in ToolBox to see changes</li>
                                    <li>üì¶ <strong>npm Package:</strong> Install published packages for testing or private use</li>
                                    <li>‚ö†Ô∏è <strong>Security:</strong> Only load/install tools you trust</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Sidebar -->
                <div class="sidebar-content" id="sidebar-settings">
                    <div class="sidebar-header">
                        <h2 class="sidebar-title">SETTINGS</h2>
                    </div>
                    <div class="sidebar-body">
                        <div class="settings-container-sidebar">
                            <div class="setting-group">
                                <label class="setting-label" for="sidebar-theme-select">Theme</label>
                                <select id="sidebar-theme-select" class="fluent-select">
                                    <option value="system">System</option>
                                    <option value="light">Light</option>
                                    <option value="dark">Dark</option>
                                </select>
                            </div>
                            <div class="setting-group">
                                <label class="setting-label" for="sidebar-auto-update-check">Auto Update</label>
                                <div class="setting-checkbox-group">
                                    <input type="checkbox" id="sidebar-auto-update-check" class="fluent-checkbox" />
                                    <span class="setting-hint">Automatically check for updates</span>
                                </div>
                            </div>
                            <div class="setting-group">
                                <label class="setting-label" for="sidebar-show-debug-menu-check">Show Debug Menu</label>
                                <div class="setting-checkbox-group">
                                    <input type="checkbox" id="sidebar-show-debug-menu-check" class="fluent-checkbox" />
                                    <span class="setting-hint">Show the Debug option in the activity bar</span>
                                </div>
                            </div>
                            <div class="setting-group">
                                <label class="setting-label" for="sidebar-terminal-font-select">Terminal Font</label>
                                <select id="sidebar-terminal-font-select" class="fluent-select">
                                    <option value="'Consolas', 'Monaco', 'Courier New', monospace">Consolas / Monaco (Default)</option>
                                    <option value="'MesloLGS NF', 'MesloLGS Nerd Font', 'Menlo', 'DejaVu Sans Mono', 'Consolas', monospace">MesloLGS Nerd Font (Recommended)</option>
                                    <option value="'FiraCode Nerd Font', 'FiraCode NF', 'Fira Code', 'Consolas', monospace">FiraCode Nerd Font</option>
                                    <option value="'JetBrainsMono Nerd Font', 'JetBrainsMono NF', 'JetBrains Mono', 'Consolas', monospace">JetBrains Mono Nerd Font</option>
                                    <option value="'CaskaydiaCove Nerd Font', 'CaskaydiaCove NF', 'Cascadia Code', 'Consolas', monospace">CaskaydiaCove Nerd Font (Cascadia)</option>
                                    <option value="'Hack Nerd Font', 'Hack NF', 'Hack', 'Consolas', monospace">Hack Nerd Font</option>
                                    <option value="'UbuntuMono Nerd Font', 'UbuntuMono NF', 'Ubuntu Mono', 'Consolas', monospace">Ubuntu Mono Nerd Font</option>
                                    <option value="'SourceCodePro Nerd Font', 'SauceCodePro NF', 'Source Code Pro', 'Consolas', monospace">Source Code Pro Nerd Font</option>
                                    <option value="'JetBrains Mono', 'Consolas', monospace">JetBrains Mono</option>
                                    <option value="'Fira Code', 'Consolas', monospace">Fira Code</option>
                                    <option value="'Cascadia Code', 'Consolas', monospace">Cascadia Code</option>
                                    <option value="custom">Custom Font...</option>
                                </select>
                                <div id="custom-font-input-container" style="display: none; margin-top: 8px">
                                    <input type="text" id="sidebar-terminal-font-custom" class="fluent-input" placeholder="e.g., 'My Font', monospace" />
                                    <span class="setting-hint">Enter font family CSS value (e.g., 'Font Name', 'Fallback', monospace)</span>
                                </div>
                                <span class="setting-hint">Choose a font for the terminal. Install the font on your system first. <a href="#" id="font-help-link">Need help installing fonts?</a></span>
                            </div>
                            <div class="setting-group">
                                <button id="sidebar-save-settings-btn" class="fluent-button fluent-button-primary">Save Settings</button>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Tool Panel (for launched tools) -->
                <div id="tool-panel" class="tool-panel" style="display: none">
                    <div class="tool-panel-header">
                        <div class="tool-tabs" id="tool-tabs">
                            <!-- Tabs will be dynamically added here -->
                        </div>
                        <div class="tool-panel-controls">
                            <button class="btn-icon" id="close-all-tools" title="Close all tools">‚úï</button>
                        </div>
                    </div>
                    <div class="tool-panel-content-wrapper" id="tool-panel-content-wrapper">
                        <div class="tool-panel-content" id="tool-panel-content">
                            <!-- BrowserView tools are rendered here by the backend ToolWindowManager -->
                        </div>
                    </div>
                    <!-- Terminal Panel -->
                    <div class="terminal-panel" id="terminal-panel" style="display: none">
                        <div class="terminal-panel-header">
                            <div class="terminal-tabs" id="terminal-tabs">
                                <!-- Terminal tabs will be dynamically added here -->
                            </div>
                            <div class="terminal-panel-controls">
                                <button class="btn-icon" id="terminal-panel-close" title="Hide terminal">
                                    <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                                        <path d="M8 8.707l3.646 3.647.708-.707L8.707 8l3.647-3.646-.707-.708L8 7.293 4.354 3.646l-.707.708L7.293 8l-3.646 3.646.707.708L8 8.707z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="terminal-panel-content" id="terminal-panel-content">
                            <!-- Terminal outputs will be dynamically added here -->
                        </div>
                    </div>
                    <div class="terminal-resize-handle" id="terminal-resize-handle" style="display: none"></div>
                    <!-- <div class="tool-panel-footer" id="tool-panel-footer">
                        <div class="footer-connection-info" id="footer-connection-info">
                            <span class="footer-label">Connection:</span>
                            <span class="footer-value" id="footer-connection-name">Not Connected</span>
                            <button class="footer-link-btn" id="footer-change-connection-btn" style="display: none">Change</button>
                        </div>
                        <button class="footer-link-btn" id="footer-toggle-terminal-btn" title="Toggle terminal">
                            <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                                <path d="M1.5 2.5h13v11h-13v-11zm1 1v9h11v-9h-11z" />
                                <path d="M3 5h1v1H3V5zm2 0h1v1H5V5zm-2 2h1v1H3V7zm2 0h1v1H5V7z" />
                            </svg>
                            Terminal
                        </button>
                    </div> -->
                </div>

                <!-- Home/Welcome View -->
                <div id="home-view" class="view active">
                    <div class="home-container">
                        <div class="home-header">
                            <h1 class="home-title">Power Platform Tool Box</h1>
                            <p class="home-subtitle">A universal desktop app for Power Platform tools</p>
                        </div>

                        <div class="home-content">
                            <!-- What's New Section -->
                            <section class="home-section">
                                <div class="section-icon">
                                    <svg width="24" height="24" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                                        <path
                                            d="M8.568 1.031A6.8 6.8 0 0 1 12.76 3.05a7.06 7.06 0 0 1 .46 9.39 6.85 6.85 0 0 1-8.58 1.74 7 7 0 0 1-3.12-3.5 7.12 7.12 0 0 1-.23-4.71 7 7 0 0 1 2.77-3.79 6.8 6.8 0 0 1 4.508-1.149zM9.04 13.88a5.89 5.89 0 0 0 3.18-2.630 6.07 6.07 0 0 0 .29-5.12 5.94 5.94 0 0 0-2.23-2.8 5.82 5.82 0 0 0-4.59-.61 6 6 0 0 0-3.7 3.17 6.1 6.1 0 0 0 .24 5.58 5.93 5.93 0 0 0 3.39 2.78 5.82 5.82 0 0 0 3.42-.37z"
                                        />
                                        <path d="M7.5 6h1v3h-1V6z" />
                                        <path d="M8 10.5a.5.5 0 1 0 0 1 .5.5 0 0 0 0-1z" />
                                    </svg>
                                </div>
                                <h2 class="section-title">What's New</h2>
                                <p class="section-description">Latest updates and features in Power Platform Tool Box:</p>
                                <ul class="feature-list">
                                    <li>üé® Modern VS Code-inspired interface with activity bar and sidebar</li>
                                    <li>üîß Install and manage tools from the marketplace</li>
                                    <li>üîó Manage multiple Dataverse connections</li>
                                    <li>‚öôÔ∏è Customizable settings and themes</li>
                                    <li>üîÑ Automatic updates to keep your toolbox current</li>
                                </ul>
                            </section>

                            <!-- Getting Started Section -->
                            <section class="home-section">
                                <div class="section-icon">
                                    <svg width="24" height="24" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M10.072 8.024L5.715 3.667l.618-.62L11 7.716v.618L6.333 13l-.618-.619 4.357-4.357z" />
                                    </svg>
                                </div>
                                <h2 class="section-title">Getting Started</h2>
                                <p class="section-description">Follow these steps to get started with Power Platform Tool Box:</p>
                                <ol class="steps-list">
                                    <li>
                                        <span class="step-icon">üì¶</span>
                                        <div><strong>Install Tools:</strong> Browse the marketplace in the sidebar to discover and install tools</div>
                                    </li>
                                    <li>
                                        <span class="step-icon">üîó</span>
                                        <div><strong>Add Connection:</strong> Set up your Dataverse environment connections in the connections panel</div>
                                    </li>
                                    <li>
                                        <span class="step-icon">üöÄ</span>
                                        <div><strong>Launch Tools:</strong> Open installed tools from the tools sidebar and start working!</div>
                                    </li>
                                </ol>
                            </section>

                            <!-- Action Buttons -->
                            <section class="home-section home-actions">
                                <a href="#" id="sponsor-btn" class="action-card">
                                    <div class="action-icon">
                                        <svg width="24" height="24" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                                            <path
                                                d="M7.655 14.9160005l-.53-.53-.53.53v.7l.53-.52.53.52v-.7zm-.006-1.3340001l-.528-.528-5.7-5.7L1 7.5v.7l5.17 5.17.485.48.485-.48L12.32 8.2l.5-.5v-.7l-.42-.45-5.6-5.7-.53-.53-.53.53-5.7 5.74L0 6.63v.68l6.13 6.17.52.5.52-.5 5.7-5.7.36-.35v-.7l-.42-.45-5.17-5.19z"
                                            />
                                        </svg>
                                    </div>
                                    <div class="action-content">
                                        <h3>Sponsor This Project</h3>
                                        <p>Support the development of Power Platform Tool Box</p>
                                    </div>
                                </a>

                                <a href="#" id="github-btn" class="action-card">
                                    <div class="action-icon">
                                        <svg width="24" height="24" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                                            <path
                                                d="M7.976 0A7.977 7.977 0 0 0 0 7.976c0 3.522 2.3 6.507 5.431 7.584.392.049.538-.196.538-.392v-1.37c-2.201.49-2.69-1.076-2.69-1.076-.343-.93-.881-1.175-.881-1.175-.734-.489.048-.489.048-.489.783.049 1.224.832 1.224.832.734 1.223 1.859.88 2.3.685.048-.538.293-.88.489-1.076-1.762-.196-3.621-.881-3.621-3.964 0-.88.293-1.566.832-2.153-.05-.147-.343-.978.098-2.055 0 0 .685-.196 2.201.832.636-.196 1.322-.245 2.007-.245s1.37.098 2.006.245c1.517-1.027 2.202-.832 2.202-.832.44 1.077.146 1.908.097 2.104a3.16 3.16 0 0 1 .832 2.153c0 3.083-1.86 3.719-3.62 3.915.293.244.538.733.538 1.467v2.202c0 .196.146.44.538.392A7.984 7.984 0 0 0 16 7.976C15.951 3.572 12.38 0 7.976 0z"
                                            />
                                        </svg>
                                    </div>
                                    <div class="action-content">
                                        <h3>View on GitHub</h3>
                                        <p>Explore the source code and contribute</p>
                                    </div>
                                </a>

                                <a href="#" id="bugs-features-btn" class="action-card">
                                    <div class="action-icon">
                                        <svg width="24" height="24" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                                            <path
                                                fill-rule="evenodd"
                                                clip-rule="evenodd"
                                                d="M9.0001 1.99999L10.5001 3.49999V1.99999H11.5001V3.49999L13.0001 1.99999L13.7072 2.70709L12.2001 4.21419V5.49999H13.4859L15.0001 3.99999L15.7072 4.70709L14.2001 6.21419V9.78579L15.7072 11.293L15.0001 12.0001L13.4859 10.5001H12.2001V11.7859L13.7072 13.293L13.0001 14.0001L11.5001 12.5001V14.0001H10.5001V12.5001L9.0001 14.0001L8.29299 13.293L9.8001 11.7859V10.5001H8.51429L7.0001 12.0001L6.29299 11.293L7.8001 9.78579V6.21419L6.29299 4.70709L7.0001 3.99999L8.51429 5.49999H9.8001V4.21419L8.29299 2.70709L9.0001 1.99999ZM11.2001 6.49999H8.8001V9.49999H11.2001V6.49999Z"
                                            />
                                            <path
                                                fill-rule="evenodd"
                                                clip-rule="evenodd"
                                                d="M5.2072 9.79289L3.0001 12V9.99999H2.0001V12C2.0001 12.2652 2.10545 12.5196 2.29299 12.7071L4.5001 14.9142L5.2072 14.2071L3.4143 12.4142C3.78924 12.4759 4.17359 12.5076 4.5645 12.5076C6.20103 12.5076 7.5645 11.1441 7.5645 9.50762V6.49237C7.5645 4.85584 6.20103 3.49237 4.5645 3.49237C4.17359 3.49237 3.78924 3.52414 3.4143 3.58576L5.2072 1.79289L4.5001 1.08578L2.29299 3.29289C2.10545 3.48043 2.0001 3.73478 2.0001 4V5.99999H3.0001V4L5.2072 1.79289L4.5001 1.08578ZM4.5645 11.5076C5.64874 11.5076 6.5645 10.5918 6.5645 9.50762V6.49237C6.5645 5.40813 5.64874 4.49237 4.5645 4.49237C3.48025 4.49237 2.5645 5.40813 2.5645 6.49237V9.50762C2.5645 10.5918 3.48025 11.5076 4.5645 11.5076Z"
                                            />
                                        </svg>
                                    </div>
                                    <div class="action-content">
                                        <h3>Report Issues & Requests</h3>
                                        <p>Log bugs or request new features on GitHub</p>
                                    </div>
                                </a>

                                <a href="#" id="create-tool-btn" class="action-card">
                                    <div class="action-icon">
                                        <svg width="24" height="24" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                                            <path
                                                fill-rule="evenodd"
                                                clip-rule="evenodd"
                                                d="M9.5 1.1l3.4 3.5.1.4v2h-1V5.5L8 5v-.5l.5-.5h1.6L7.9 1.8 7.5 1.1h2zM9 2v3h3V4H9.7L9 2zM1 14.5V13h1.5v1.5H4V16H1.5v-1.5H1zm6.5 0V13H9v1.5h1.5V16H8v-1.5H6.5zm6 0V13H15v1.5h-1.5V16H12v-1.5h-1.5zM7 7H1.5L1 6.5v-5l.5-.5h5l.5.5V7zm-1-5H2v4h4V2zm7.5 7h-2.25v1.5h2.25V10H15v3.5h-1.5V12zm-8.25 0H3v1.5h2.25V10H7v3.5H5.25V12zm5.5-2H9.25v1.5h1.5V10h1.5v3.5H10.5V12h-.75v-1.5z"
                                            />
                                        </svg>
                                    </div>
                                    <div class="action-content">
                                        <h3>Create Your Own Tool</h3>
                                        <p>Learn how to build tools for the ToolBox</p>
                                    </div>
                                </a>
                            </section>

                            <!-- Quick Links -->
                            <section class="home-section">
                                <div class="section-icon">
                                    <svg width="24" height="24" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                                        <path
                                            fill-rule="evenodd"
                                            clip-rule="evenodd"
                                            d="M13.5 1.5L13 1H7L1 7v1.5L1.5 9h1.646l.5-.5h5.208l.5.5H11v5.5l.5.5h2l.5-.5v-13zM12 14V9h-.5l-.5-.5H5.146L4.5 8H2.707L7 3.707V8.5l.5.5h1l.5-.5V2h4v12h-.5z"
                                        />
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M6 7h1v1H6V7z" />
                                    </svg>
                                </div>
                                <h2 class="section-title">Resources</h2>
                                <ul class="resource-links">
                                    <li><a href="#" id="docs-link">üìö Documentation</a></li>
                                    <li><a href="#" id="tool-dev-guide-link">üõ†Ô∏è Tool Development Guide</a></li>
                                    <li><a href="#" id="architecture-link">üèóÔ∏è Architecture Overview</a></li>
                                    <li><a href="#" id="contributing-link">ü§ù Contributing Guidelines</a></li>
                                </ul>
                            </section>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Footer with connection status -->
        <footer class="app-footer">
            <div class="footer-content">
                <span id="connection-status" class="connection-status">No active connection</span>
            </div>
        </footer>

        <!-- Add Connection Modal -->
        <div id="add-connection-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Dataverse Connection</h3>
                    <button class="modal-close" id="close-connection-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <label for="connection-name">Connection Name:</label>
                    <input type="text" id="connection-name" placeholder="Production" class="modal-input" />

                    <label for="connection-url">Environment URL:</label>
                    <input type="text" id="connection-url" placeholder="https://org.crm.dynamics.com" class="modal-input" />

                    <label for="connection-authentication-type">Authentication Type:</label>
                    <select id="connection-authentication-type" class="modal-input">
                        <option value="interactive">Microsoft Login Prompt</option>
                        <option value="clientSecret">Client ID/Secret</option>
                        <option value="usernamePassword">Username/Password</option>
                    </select>

                    <label for="connection-environment">Environment:</label>
                    <select id="connection-environment" class="modal-input">
                        <option value="Dev">Dev</option>
                        <option value="Test">Test</option>
                        <option value="UAT">UAT</option>
                        <option value="Production">Production</option>
                    </select>

                    <!-- Client ID/Secret fields (hidden by default) -->
                    <div id="client-secret-fields" style="display: none">
                        <label for="connection-client-id">Client ID:</label>
                        <input type="text" id="connection-client-id" placeholder="client-id" class="modal-input" />

                        <label for="connection-client-secret">Client Secret:</label>
                        <div style="position: relative">
                            <input type="password" id="connection-client-secret" placeholder="client-secret" class="modal-input" />
                            <button
                                type="button"
                                class="password-toggle-btn"
                                id="toggle-client-secret"
                                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer"
                            >
                                üëÅÔ∏è
                            </button>
                        </div>

                        <label for="connection-tenant-id">Tenant ID:</label>
                        <input type="text" id="connection-tenant-id" placeholder="tenant-id" class="modal-input" />
                    </div>

                    <!-- Username/Password fields (hidden by default) -->
                    <div id="username-password-fields" style="display: none">
                        <label for="connection-username">Username:</label>
                        <input type="text" id="connection-username" placeholder="user@domain.com" class="modal-input" />

                        <label for="connection-password">Password:</label>
                        <div style="position: relative">
                            <input type="password" id="connection-password" placeholder="password" class="modal-input" />
                            <button
                                type="button"
                                class="password-toggle-btn"
                                id="toggle-password"
                                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer"
                            >
                                üëÅÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="test-connection-btn" class="fluent-button fluent-button-secondary" style="display: none; margin-right: auto">Test Connection</button>
                    <button id="cancel-connection-btn" class="fluent-button fluent-button-secondary">Cancel</button>
                    <button id="confirm-connection-btn" class="fluent-button fluent-button-primary">Add</button>
                </div>
            </div>
        </div>

        <!-- Connection Selection Modal -->
        <div id="connection-select-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Select Connection</h3>
                    <button class="modal-close" id="close-connection-select-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Select a connection for this tool:</p>
                    <div id="connection-select-list" class="connection-select-list">
                        <!-- Connections will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancel-connection-select-btn" class="fluent-button fluent-button-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Device Code Modal -->
        <div id="device-code-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Device Authentication</h3>
                </div>
                <div class="modal-body">
                    <p id="device-code-message" style="white-space: pre-wrap; font-family: monospace; background: #f5f5f5; padding: 15px; border-radius: 4px; margin: 10px 0">
                        <!-- Device code message will be displayed here -->
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="close-device-code-btn" class="fluent-button fluent-button-secondary">Close</button>
                </div>
            </div>
        </div>

        <!-- Authentication Error Modal -->
        <div id="auth-error-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Authentication Error</h3>
                    <button class="modal-close" id="close-auth-error-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="auth-error-message" style="color: #d83b01; padding: 15px">
                        <!-- Error message will be displayed here -->
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="close-auth-error-btn" class="fluent-button fluent-button-primary">OK</button>
                </div>
            </div>
        </div>

        <!-- Tool Settings Modal -->
        <div id="tool-settings-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Tool Settings</h3>
                    <button class="modal-close" id="close-tool-settings-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="tool-settings-content">
                        <!-- Tool settings will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancel-tool-settings-btn" class="fluent-button fluent-button-secondary">Close</button>
                </div>
            </div>
        </div>

        <!-- Tool Detail Modal -->
        <div id="tool-detail-modal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3 id="tool-detail-title">Tool Details</h3>
                    <button class="modal-close" id="close-tool-detail-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="tool-detail-content">
                        <!-- Tool details will be loaded here -->
                        <div class="tool-detail-header">
                            <div class="tool-detail-info">
                                <h2 id="tool-detail-name"></h2>
                                <p id="tool-detail-description"></p>
                                <div class="tool-detail-meta">
                                    <span id="tool-detail-author"></span>
                                    <span id="tool-detail-category"></span>
                                </div>
                            </div>
                            <div class="tool-detail-actions">
                                <button id="tool-detail-install-btn" class="fluent-button fluent-button-primary" style="display: none">Install</button>
                                <span id="tool-detail-installed-badge" class="fluent-badge fluent-badge-success" style="display: none">Installed</span>
                            </div>
                        </div>
                        <div class="tool-detail-readme">
                            <h3>README</h3>
                            <div id="tool-detail-readme-content" class="markdown-content">
                                <p class="loading-text">Loading README...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Screen Overlay (scoped to active tool) -->
        <div id="loading-screen" class="loading-screen" style="display: none">
            <div class="loading-spinner"></div>
            <div id="loading-message" class="loading-message">Loading...</div>
        </div>

        <!-- VS Code-style Notification Container -->
        <div id="notification-container" class="notification-container"></div>

        <script type="module" src="renderer.ts"></script>
    </body>
</html>
